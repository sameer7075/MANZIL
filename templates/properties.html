<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Properties - MANZIL</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/results.css') }}">
</head>

<body>

    <header class="navbar">
        <a href="{{ url_for('index') }}" class="logo">
            <div class="Heading">
                <span class="red">MAN</span><span>ZIL</span>
            </div>
        </a>

        <div class="nav-buttons">
            <nav>
                <ul>
                    <li><a href="{{ url_for('view_properties', purpose='For Sale') }}" class="btn">Buy</a></li>
                    {% if current_user.is_authenticated %}
                    <li><a href="{{ url_for('add_property') }}">Sell</a></li>
                    {% endif %}
                    <li><a href="{{ url_for('view_properties', purpose='For Rent') }}" class="btn">Rent</a></li>
                </ul>
            </nav>
        </div>

        <div class="auth-buttons">
            {% if current_user.is_authenticated %}
            <div class="user-actions">
                <div class="icon-wrapper">
                    <img src="{{ url_for('static', filename='images/inbox.png') }}" alt="Inbox" class="icon">
                </div>
                <div class="icon-wrapper">
                    <img src="{{ url_for('static', filename='images/favourites.png') }}" alt="Favorites" class="icon">
                </div>
                <div class="icon-wrapper user-icon">
                    <img src="{{ url_for('static', filename='images/user.png') }}" alt="User" class="icon">
                    <div class="user-card">
                        <p><strong>{{ current_user.username }}</strong></p>
                        <p>{{ current_user.email }}</p>
                        <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
                    </div>
                </div>
            </div>
            {% else %}
            <a href="{{ url_for('login') }}" class="login">Log In</a>
            <a href="{{ url_for('register') }}" class="signup">Sign Up</a>
            {% endif %}
        </div>
    </header>


    <div class="main-body">
        <form action="{{ url_for('view_properties') }}" method="get">
            <div class="search-box2">


                <div class="select-menu2">
                    <div class="select-btn">
                        <span class="sBtn-text">{{ request.args.get('purpose', 'All') or 'All' }}</span>
                        <img src="{{ url_for('static', filename='images/down-arrow.png') }}" class="icon" alt="">
                    </div>
                    <ul class="options">
                        <li class="option"><span class="option-text">All</span></li>
                        <li class="option"><span class="option-text">For Sale</span></li>
                        <li class="option"><span class="option-text">For Rent</span></li>
                    </ul>
                    <input type="hidden" name="purpose" value="{{ request.args.get('purpose', '') }}">
                </div>

                <input type="text" name="query" placeholder="Address, School, City, Zip or Neighborhood"
                    value="{{ request.args.get('query', '') }}" />
                <button type="submit">
                    <span><img src="{{ url_for('static', filename='images/search.png') }}" alt="Search"
                            class="search-icon"></span>
                </button>
            </div>
        </form>



        <div class="content">

            <aside class="sidebar">
                <h3>Filters</h3>
                <form action="{{ url_for('view_properties') }}" method="get">


                    <label>City</label>
                    <div class="select-menu">
                        <div class="select-btn">
                            <span class="sBtn-text">{{ request.args.get('city', 'Any') or 'Any' }}</span>
                            <img src="{{ url_for('static', filename='images/down-arrow.png') }}" class="icon" alt="">
                        </div>
                        <ul class="options">
                            <li class="option"><span class="option-text">Any</span></li>
                            {% for city in cities %}
                            <li class="option"><span class="option-text">{{ city }}</span></li>
                            {% endfor %}
                        </ul>
                        <input type="hidden" name="city" value="{{ request.args.get('city', '') }}">
                    </div>


                    <label>Property Type</label>
                    <div class="select-menu">
                        <div class="select-btn">
                            <span class="sBtn-text">{{ request.args.get('type', 'Any') or 'Any' }}</span>
                            <img src="{{ url_for('static', filename='images/down-arrow.png') }}" class="icon" alt="">
                        </div>
                        <ul class="options">
                            <li class="option"><span class="option-text">Any</span></li>
                            <li class="option"><span class="option-text">House</span></li>
                            <li class="option"><span class="option-text">Apartment</span></li>
                            <li class="option"><span class="option-text">Plot</span></li>
                            <li class="option"><span class="option-text">Commercial</span></li>
                        </ul>
                        <input type="hidden" name="type" value="{{ request.args.get('type', '') }}">
                    </div>


                    <label for="min_price">Min Price</label>
                    <input type="number" name="min_price" id="min_price"
                        value="{{ request.args.get('min_price', '') }}">


                    <label for="max_price">Max Price</label>
                    <input type="number" name="max_price" id="max_price"
                        value="{{ request.args.get('max_price', '') }}">


                    <label for="min_area">Min Area (sqft)</label>
                    <input type="number" name="min_area" id="min_area" value="{{ request.args.get('min_area', '') }}">


                    <label for="max_area">Max Area (sqft)</label>
                    <input type="number" name="max_area" id="max_area" value="{{ request.args.get('max_area', '') }}">


                    <label>Bedrooms</label>
                    <div class="select-menu">
                        <div class="select-btn">
                            <span class="sBtn-text">{{ request.args.get('bedrooms', 'Any') or 'Any' }}</span>
                            <img src="{{ url_for('static', filename='images/down-arrow.png') }}" class="icon" alt="">
                        </div>
                        <ul class="options">
                            <li class="option"><span class="option-text">Any</span></li>
                            <li class="option"><span class="option-text">1+</span></li>
                            <li class="option"><span class="option-text">2+</span></li>
                            <li class="option"><span class="option-text">3+</span></li>
                            <li class="option"><span class="option-text">4+</span></li>
                        </ul>
                        <input type="hidden" name="bedrooms" value="{{ request.args.get('bedrooms', '') }}">
                    </div>


                    <label>Bathrooms</label>
                    <div class="select-menu">
                        <div class="select-btn">
                            <span class="sBtn-text">{{ request.args.get('bathrooms', 'Any') or 'Any' }}</span>
                            <img src="{{ url_for('static', filename='images/down-arrow.png') }}" class="icon" alt="">
                        </div>
                        <ul class="options">
                            <li class="option"><span class="option-text">Any</span></li>
                            <li class="option"><span class="option-text">1+</span></li>
                            <li class="option"><span class="option-text">2+</span></li>
                            <li class="option"><span class="option-text">3+</span></li>
                        </ul>
                        <input type="hidden" name="bathrooms" value="{{ request.args.get('bathrooms', '') }}">
                    </div>


                    <label>Furnished Status</label>
                    <div class="select-menu">
                        <div class="select-btn">
                            <span class="sBtn-text">{{ request.args.get('furnished_status', 'Any') or 'Any' }}</span>
                            <img src="{{ url_for('static', filename='images/down-arrow.png') }}" class="icon" alt="">
                        </div>
                        <ul class="options">
                            <li class="option"><span class="option-text">Any</span></li>
                            <li class="option"><span class="option-text">Furnished</span></li>
                            <li class="option"><span class="option-text">Unfurnished</span></li>
                        </ul>
                        <input type="hidden" name="furnished_status"
                            value="{{ request.args.get('furnished_status', '') }}">
                    </div>


                    <div class="filter-buttons">
                        <button type="submit" class="apply-btn">Apply</button>
                        <a href="{{ url_for('view_properties') }}" class="reset-btn">Reset</a>
                    </div>

                </form>
            </aside>



            <section class="property-list">
                {% if properties %}
                {%if properties|length == 1%}
                <p class="results-count">{{ properties|length }} Result Found</p>
                {%else%}
                <p class="results-count">{{ properties|length }} Results Found</p>
                {%endif%}
                {% for property in properties %}
                <div class="property-card">
                    <div class="property-image">
                        {% set image_list = property.images.split(',') if property.images else [] %}
                        <img src="{{ url_for('static', filename='uploads/' + image_list[0]) }}"
                            alt="{{ property.title }}">
                    </div>

                    <div class="property-details">
                        <div class="property-header">
                            <span class="status">{{property.purpose}}</span>

                            <p><strong> PKR {{ "{:,.0f}".format(property.price) }}</strong></p>
                        </div>

                        <div class="property-title">
                            <h2>{{ property.title }}</h2>
                        </div>


                        <p class="location">
                            <i class="fa fa-map-marker-alt"></i> {{ property.area_name }}, {{ property.city }}
                        </p>

                        <div class="property-icons">
                            <span><img src="{{ url_for('static', filename='images/bed.png') }}" alt="Bedrooms"
                                    class="icon-img"> {{ property.bedrooms }}</span>
                            <span><img src="{{ url_for('static', filename='images/bath.png') }}" alt="Bedrooms"
                                    class="icon-img"> {{ property.bathrooms }}</span>
                            <span><img src="{{ url_for('static', filename='images/ruler.png') }}" alt="Bedrooms"
                                    class="icon-img"> {{ "{:,.0f}".format(property.area) }} {{ property.unit }}</span>
                        </div>

                        <p class="type">{{ property.type | upper }}</p>

                        <div class="property-footer">
                            <a href="/property/{{ property.id }}" class="details-btn">Details</a>
                        </div>
                    </div>
                </div>

                {% endfor %}
                {% else %}
                <p class="results-count">No properties found.</p>
                {% endif %}
            </section>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-container">
            <div class="footer-left">
                <h2 class="footer-logo"><span class="red">MAN</span>ZIL</h2>
                <p>Your trusted partner in buying, selling, and renting properties — built with care by Team AEGIS.</p>
            </div>

            <div class="footer-links">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="{{ url_for('view_properties', purpose='For Sale') }}" class="btn">Buy</a></li>
                    {% if current_user.is_authenticated %}
                    <li><a href="{{ url_for('add_property') }}">Sell</a></li>
                    {% endif %}
                    <li><a href="{{ url_for('view_properties', purpose='For Rent') }}" class="btn">Rent</a></li>

                </ul>
            </div>

            <div class="footer-contact">
                <h4>Contact Us</h4>
                <p>Email: support@manzil.com</p>
                <p>Phone: +92 300 1234567</p>
                <p>Location: Islamabad, Pakistan</p>
            </div>
        </div>

        <div class="footer-bottom">
            <p>© 2025 MANZIL | Designed & Developed by <strong>Team AEGIS</strong></p>
        </div>
    </footer>


    <script src="{{ url_for('static', filename='js/dropdowns.js') }}"></script>
</body>

</html>